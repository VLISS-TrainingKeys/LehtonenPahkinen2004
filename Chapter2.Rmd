---
title: "Chapter 2: Basic Sampling Techniques"
output_dir: "docs"
output: 
  html_document:
    toc: true
    toc_float: true
    collapsed: true
    smooth_scroll: true
    theme: flatly
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In Chapter 2 of the textbook **Practical Methods for Design and Analysis of Complex Surveys**, Simple random sampling, systematic sampling and sampling with probability proportional to size are introduced as the basic sampling techniques. The estimation of three different population parameters (population total, ratio and median) is examined. A small fixed population – the Province’91 population - is used throughout to illustrate the estimation methods, where the main focus is on the derivation of appropriate sampling weights under each sampling technique. Special efforts are made in comparing the relative performances of the estimators (in terms of their standard errors) and the available information on the structure of the population is increasingly utilized. The use of such auxiliary information is considered for two purposes: the sampling design and the estimation of parameters for a given sampling design.

In **Training Key 28**, SRSWOR sampling is demonstrated by first reproducing the results of Example 2.1. Then, the SRSWOR estimation procedure is extended to samples with different sample sizes. Finally, the performance of SRSWOR estimators is examined by using Monte Carlo simulation methods.

In **Training Key 45**, intra-class correlation is demonstrated under systematic sampling. First, the results of Example 2.4 are reproduced. Then, intra-class correlation is examined for systematic sampling under varying sorting orders of the population.

In **Training Key 54**, PPS sampling is demonstrated by first reproducing the results of Example 2.6. Then, PPS sampling is examined in more detail by incorporating different types of auxiliary data into the estimation procedure.


<!-- NOTE: Instructions for the use of Training Keys are given in the Instructions section. -->

# 2.2 The Province'91 population

<a href="Datat/province91.sas7bdat">Download SAS data</a> |
<a href="Datat/province91.sav">Download SPSS data</a> |
<a href="Datat/province91.xls">Download Excel file</a> |
<a href="Datat/Province91.txt">Download text file</a>

 
```{r eval=FALSE}
install.packages("tidyverse")
library(tidyverse)
province91 <- tribble(
  ~Stratum,	~Cluster, ~Id, ~Municipality, ~POP91, ~LAB91, ~UE91, ~HOU85, ~URB85,
  #--|--|----
  1, 1,	1, "Jyväskylä", 67200, 33786, 4123, 26881, 1,
  1, 2,	2, "Jämsä",	12907, 6016, 666, 4663, 1,
  1, 2, 3, "Jämsänkoski", 8118,	3818,	528, 3019, 1,
  1, 2, 4, "Keuruu", 12707,	5919,	760, 4896, 1,
  1, 3, 5, "Saarijärvi", 10774,	4930,	721, 3730, 1,
  1, 5, 6, "Suolahti", 6159, 3022, 457, 2389, 1,
  1, 3, 7, "Äänekoski", 11595, 5823, 767, 4264, 1,
  2, 5, 8, "Hankasalmi", 6080, 2594, 391, 2179, 0,
  2, 6, 9, "Joutsa", 4594, 2069, 194, 1823, 0,
  2, 7, 10,	"Jyväskmlk", 29349, 13727, 1623, 9230, 0,
  2, 4, 11, "Kannonkoski", 1919, 821, 153, 726, 0,
  2, 4, 12, "Karstula", 5594, 2521, 341, 1868, 0,
  2, 8, 13, "Kinnula", 2324, 927, 129, 675, 0,
  2, 8, 14, "Kivijärvi", 1972, 819, 128, 634, 0,
  2, 3, 15, "Konginkangas", 1636, 675, 142, 556, 0,
  2, 5, 16, "Konnevesi", 3453, 1557, 201, 1215, 0,
  2, 1, 17, "Korpilahti", 5181, 2144, 239, 1793, 0,
  2, 2, 18, "Kuhmoinen", 3357, 1448, 187, 1463, 0,
  2, 4, 19, "Kyyjärvi", 1977, 831, 94, 672, 0,
  2, 5, 20, "Laukaa", 16042, 7218, 874, 4952, 0,
  2, 6, 21, "Leivonmäki", 1370, 573, 61, 545, 0,
  2, 6, 22, "Luhanka", 1153, 522, 54, 435, 0,
  2, 7, 23, "Multia", 2375, 1059, 119, 925, 0,
  2, 1, 24, "Muurame", 6830, 3024, 296, 1853, 0,
  2, 7, 25, "Petäjävesi", 3800, 1737, 262, 1352, 0,
  2, 8, 26, "Pihtipudas", 5654, 2543, 331, 1946, 0,
  2, 4, 27, "Pylkönmäki", 1266, 545, 98, 473, 0,
  2, 3, 28, "Sumiainen", 1426, 617, 79, 485, 0,
  2, 1, 29, "Säynätsalo", 3628, 1615, 166, 1226, 0,
  2, 6, 30, "Toivakka", 2499, 1084, 127, 834, 0,
  2, 7, 31, "Uurainen", 3004, 1330, 219, 932, 0,
  2, 8, 32, "Viitasaari", 8641, 4011, 568, 3119, 0
)
# save the population data for future use
save(province91, file="province91.RData")
# to download the population data use:
load(file="province91.RData")
```

**Variables:** 	 

* Stratum = Stratum identification 1=Urban, 2=Rural
* Cluster = Cluster identification
* Id = ID key
* Municipality = Name of municipality
* POP91 =	Population in 1991 (Official statistics)
* LAB =	Labour force in 1991 (Official statistics)
* UE91 = Unemployed in 1991 (Official statistics)
* HOU85 = Households in 1985 (Population Census)
* URB85 = Urbanicity in 1985 1= Urban, 0=Rural (Population Census)

```{r echo = FALSE, results = 'asis'}
load(file="province91.RData")
library(knitr)
kable(province91, caption = "THE PROVINCE91 POPULATION")
```

# TRAINING KEY 28: Analysing an SRS sample

### INTRODUCTION

In this Training Key we use the [Province'91 data set](concepts/concepts.html) as a frame population in analysing an [SRSWOR](concepts/concepts.html) sample. In part A we calculate the SRSWOR estimates for the total of UE91 (number of unemployed in the province) and for the total of LAB91 (number of work force in the province) and their corresponding standard errors from the selected sample where sample size is eight $(n=8)$. In part B, we examine how sample size affects to the SRSWOR estimates and their standard errors by selecting different sample sizes. In part C we simulate SRSWOR samples by using Monte Carlo simulation techniques to examine the behaviour of the SRSWOR estimator. Part D is the option for interactive analysis.

#### A) ANALYSING AN SRS SAMPLE FROM THE PROVINCE'91 POPULATION

We calculate the SRSWOR (simple random sampling without replacement) total estimates of UE91 and LAB91, the ratio estimate (UE91/LAB91) and their corresponding standard error estimates. We use Province'91 data set as the frame population. 

<a href="Keys/key28/key28a_9.htm" target="_blank">Start SAS Training Key</a>

```{r, message=FALSE}
# Create a sample including Jyväskylä, Keuruu, Saarijärvi, Konginkangas, Kuhmoinen, Pihtipudas, Toivakka and Uurainen
Sample <- province91[c(1,4,5,15,18,26,30,31), ]
paste("SRSWOR sample is")
Sample
#
# load package survey (to install package use: install.packages("survey"))
library(survey)
# total=32:  fpc = finite population correction: fpc = (1-n/N)
# This column (variable) fpc simply contains the number 32 for every record
Sample$fpc <- 32
# This variable contains the weights
Sample$weights <- 4
# Construct an object called province91.srs.design specifying a simple random sampling design. 
# This province91.srs.design object will be used for all subsequent analysis commands:
province91.srs.design <- svydesign(ids = ~1, data = Sample, fpc = ~fpc, weights = ~weights)
paste("Estimates for the total of UE91 and LAB91 under simple random sampling without replacement (SRSWOR)")
# Print the weighted total and standard error of the ue91 variable:
svytotal(~UE91, province91.srs.design)
# Print the weighted total and standard error of the ue91 variable:
svytotal(~LAB91, province91.srs.design)
paste("Estimates for the ratio of UE91/LAB91 under simple random sampling without replacement (SRSWOR)")
svyratio(~UE91, ~LAB91, province91.srs.design)
confint(svyratio(~UE91, ~LAB91, province91.srs.design))
```

Selected SRSWOR sample and the estimates for the total of UE91 and LAB91 and for the ratio UE91/LAB91 are similar to the results viewed in table 2.4 on page 29 in Lehtonen and Pahkinen 2004. Pay attention to the estimates and their standard errors and try to think why SRSWOR may lack any significance for practical purposes according to this case study. 

After viewing the results, you can examine the R and SAS codes used to calculate the estimates for the total of UE91 and LAB91 and for the ratio UE91/LAB91. Then, you may move on to next step of Key 28 in which different size SRSWOR samples will be selected to study how the sample size affects to the total estimate and to the ratio estimate. 

####  B) SRS ESTIMATION WITH DIFFERENT SAMPLE SIZES

In this exercise we examine SRSWOR estimation of the total of UE91 (number of unemployed in the province) and LAB91 (size of labour force in the province) and of the ratio UE91/LAB91 by using different size SRSWOR samples. The purpose is to examine how sample size ($n$) affects to the total estimate and to the ratio estimate and their corresponding standard errors. We use Province'91 data set as the frame population.  

<a href="Keys/key28/key28b_9.htm" target="_blank">Start SAS Training Key</a>

```{r, message=FALSE}
# load packages
library(sampling)
library(survey)

# create function to select different size SRSWOR samples with user defined seed number
srs <- function(n, seed){
  print("Sample size is")
  print(n)
  set.seed(seed)
  # select a sample
  sampleprovince <- srswor(n,32)
  # the sample is
  (1:32)[sampleprovince==1]
  # selected data
  srs_sampledata <- getdata(province91, sampleprovince)
  print("Selected sample is")
  print(srs_sampledata)
  srs_sampledata$fpc <- 32
  srs_sampledata$weights <- (1/(n/32))
  # define design object
  province91.srs.design <- svydesign(ids = ~1, data = srs_sampledata, fpc = ~fpc, weights = ~weights)
  print("Estimate for the total of UE91 is")
  print(svytotal(~UE91, province91.srs.design))
  print("Estimate for the total of LAB91 is")
  print(svytotal(~LAB91, province91.srs.design))
  print("Estimate for the ratio of UE91/LAB91 and confidence interval is")
  print(svyratio(~UE91, ~LAB91, province91.srs.design))
  print(confint(svyratio(~UE91, ~LAB91, province91.srs.design)))
}
# Function srs(n, seed)
# Give sample size (n) and select your own seed number (seed). Call function srs().
srs(4,123)
srs(8,123)
srs(16,123)
srs(32,123)
```




#### C) SIMULATING SRSWOR SAMPLES BY USING MONTE CARLO SIMULATION TECHNIQUES

Monte Carlo simulations are performed to examine the behavior of the SRSWOR estimator. 

<a href="Keys/key28/key28c.htm" target="_blank">Start SAS Training Key</a>


# TRAINING KEY 45: Intra-class correlation for systematic sampling

### INTRODUCTION

In this Training Key we use the [Province'91 data set](concepts/concepts.html) as the frame population in calculating the intra-class correlation coefficient under [systematic sampling](concepts/concepts.html). The total of the study variable UE91 (number of unemployed in the province) is to be estimated. In Part A, the book example will be worked out. The effect of different sorting orders of the population on the intra-class correlation will be examined in Part B. Part C provides an option for interactive analysis.

#### A) INTRA-CLASS CORRELATION FOR SYSTEMATIC SAMPLING IN THE PROVINCE'91 POPULATION

We calculate the intra-class correlation coefficient for systematic sampling involving four separate systematic samples of eight elements (see book example 2.4 on page 45). Further instructions will be given once you start.

<a href="Keys/key45/key45a.htm" target="_blank">Start SAS Training Key, NOT COMPLETED: a html file is missing</a>

#### B) INTRA-CLASS CORRELATION FOR SYSTEMATIC SAMPLING WHEN VARYING THE SORTING ORDER

We examine the effect of the sorting order of the Province'91 population on intra-class correlation. It will be shown that the sorting order matters: the value of the intra-class correlation coefficient varies much depending on the sorting order. Further instructions will be given once you start.

<a href="Keys/key45/key45b.htm" target="_blank">Start SAS Training Key</a>
 
#### C) INTERACTIVE SAS USE

Please download the SAS code for your own further training. Instructions are given in the SAS code once you download. NOTE! You need to have access to SAS in your computer.

<a href="Keys/key45/key45a.sas" target="_blank">Download SAS code, Key45a.sas</a> 

<a href="Keys/key45/key45b.sas" target="_blank">Download SAS code, Key45b.sas</a> 


# TRAINING KEY 54: The use of auxiliary information in PPS sampling

### INTRODUCTION

In point A we will show how to perform estimation under [systematic PPS sampling (PPSSYS)](concepts/concepts.html). Point A refers to example 2.6 (page 54). In point B we will demonstrate how the use of [auxiliary information](concepts/concepts.html) affects to the total estimate of UE91 (number of unemployed in the province) and the corresponding variance estimate. This is to get familiar on the selection and use of auxiliary information in [PPS sampling](concepts/concepts.html). Point C is an option for interactive analysis. We use Province'91 data set as the frame population.

#### A) REFERENCE EXAMPLE 2.6: Estimation under systematic PPS sampling

Systematic PPS sample $(n=8)$ is drawn from the [Province'91 population](concepts/concepts.html) such that the number of households (HOU85) is used as the size measure $z$. PPSSYS estimate and the corresponding standard error estimate are calculated from the selected sample. The results are compared to estimation under [SRSWOR sampling](concepts/concepts.html). Further instructions will be given once you start.
 
<a href="Keys/key54/key54a.htm" target="_blank">Start SAS Trainig Key</a> 

#### B) THE USE OF ALTERNATIVE AUXILIARY INFORMATION IN PPSWOR SAMPLING

We use three different auxiliary variables in [PPSWOR](concepts/concepts.html) sampling. The first auxiliary variable is HOU85 (the number of households in the municipality). The two others are artificial variables x and z. These variables are constructed for pedagogical purposes to demonstrate the role of correlation of the study variable and auxiliary variable, and that a strong correlation alone does not guarantee good efficiency for PPSWOR. Further instructions are given once you start.

<a href="Keys/key54/key54b.htm" target="_blank">Start SAS Training Key</a> 

#### C) INTERACTIVE SAS USE

Please download the SAS code for your own further training. Further instructions are given once you download the code.

NOTE! You need to have access to SAS in your computer.
 
 
<a href="Keys/key54/sasmacro54.sas" target="_blank">Download SAS code</a> 

# Further Reading

### Chapter 2: Further Reading

#### TRAINING KEY 28: Analysing an SRS sample

* Cochran W.G. (1977). Sampling Techniques. 3rd edition. New York: Wiley. (Chapters 1-5)

#### TRAINING KEY 54: The use of auxiliary information in PPS sampling

* Brewer, K.R.W. and Hanif, M. (1983). Sampling with Unequal Probabilities. New York: Springer.
* Hedayat, A.S. and Sinha, B.K. (1991). Finite Population Sampling. New York: Wiley.


